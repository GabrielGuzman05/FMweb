(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-85aa3f16"],{"2e89":function(t,e,a){},"2fdb":function(t,e,a){"use strict";var s=a("5ca1"),n=a("d2c8"),r="includes";s(s.P+s.F*a("5147")(r),"String",{includes:function(t){return!!~n(this,t,r).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},"43ba":function(t,e,a){var s=a("d9f6"),n=a("63b6"),r=a("e4ae"),i=a("1bc3");n(n.S+n.F*a("294c")(function(){Reflect.defineProperty(s.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,e,a){r(t),e=i(e,!0),r(a);try{return s.f(t,e,a),!0}catch(n){return!1}}})},"4d6e":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"edgeStyleContainer"},[a("div",{staticClass:"legendContainer"},[a("ul",t._l(Object.keys(t.status),function(e){return a("li",{key:e},[t._v("\n        "+t._s(e)+"\n        "),a("div",{staticClass:"legendColor",style:{background:t.status[e]}})])}),0)]),a("div",{staticClass:"toolbarContainer"},[a("ul",t._l(t.toolbarItems,function(e){return a("li",{key:e["name"],ref:"dragItem",refInFor:!0},[t._v("\n        "+t._s(e["title"])+"\n      ")])}),0)]),a("div",{ref:"container",staticClass:"graphContainer"}),a("change-status-dialog",{ref:"dialog"})],1)},n=[],r=a("6f8a"),i=a.n(r),u=(a("7f7f"),a("ac6a"),a("6762"),a("2fdb"),a("d06c")),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"改变状态",visible:t.dialogVisible,width:"30%"}},[t.R.isNil(t.mCell)?t._e():[a("el-radio-group",{model:{value:t.mStatus,callback:function(e){t.mStatus=e},expression:"mStatus"}},t._l(t.mCell["customerOptionalStatus"],function(e){return a("el-radio",{key:e,attrs:{label:e}},[t._v(t._s(e))])}),1)],a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确 定")])],1)],2)},l=[],c={name:"changeStatusDialog",data:function(){return{dialogVisible:!1,mCell:null,mStatus:""}},methods:{openDialog:function(t){var e=this;this.mCell=t,this.dialogVisible=!0,this.$nextTick(function(){e.mStatus=t["customerStatus"]})},confirm:function(){this.mCell["customerStatus"]=this.mStatus,this.dialogVisible=!1}}},g=c,d=a("2877"),f=Object(d["a"])(g,o,l,!1,null,"30aef8c8",null),h=f.exports,m={name:"edgeStyle",components:{ChangeStatusDialog:h},data:function(){return{rubberBand:null,status:{success:"#008000",waiting:"#808080",running:"#0000ff",failed:"#ff0000",default:"#808080"},toolbarItems:[{name:"start",title:"开始节点",defaultStatus:"success"},{name:"end",title:"结束节点",defaultStatus:"success"},{name:"node",title:"普通节点",defaultStatus:"success",OptionalStatus:["success","waiting","running","failed"]},{name:"parallel",title:"并行节点",defaultStatus:"success"},{name:"branch",title:"分支节点",defaultStatus:"waiting"},{name:"Aggregation",title:"聚合节点",defaultStatus:"success"}],statusMap:{}}},methods:{setEdgeColor:function(t,e){var a=this.R.prop("style",this.graph.view.getState(t,!0));a["strokeColor"]=e;var s="";this.R.forEachObjIndexed(function(t,e){s+="".concat(e,"=").concat(t,";")},a),t.setStyle(s),this.graph.refresh(t)},createGraph:function(){this.graph=new u["mxGraph"](this.$refs.container),this.$refs.container.style.background='url("./mxgraph/images/grid.gif")'},initGraph:function(){var t=this;this.R.isNil(this.graph)||(this.rubberBand=new u["mxRubberband"](this.graph),this.graph.setConnectable(!0),this.graph.setCellsEditable(!1),this.graph.setAllowDanglingEdges(!1),this.graph.setConnectableEdges(!1),this.graph.convertValueToString=function(e){return t.R.prop("customerTitle",e)},this.graph.addListener(u["mxEvent"].DOUBLE_CLICK,function(e,a){var s=t.R.pathOr([],["properties","cell"],a);t.R.equals("node",s["customerName"])&&t.$refs.dialog.openDialog(s)}),this.graph.connectionHandler.validateConnection=function(e,a){var s=e["customerName"],n=a["customerName"];return e!==a&&(!t.R.equals("end",s)&&(!t.R.equals("start",n)&&((!t.R.equals("parallel",n)||!(a["edges"]instanceof Array&&a["edges"].length>=1||t.R.equals("start",s)))&&((!t.R.equals("branch",n)||!t.R.equals("start",s))&&((!t.R.equals("Aggregation",n)||!t.R.equals("start",s))&&null)))))},this.graph.connectionHandler.addListener(u["mxEvent"].CONNECT,function(e,a){var s=a.getProperty("cell"),n=s["source"],r=s["target"],i=n["customerStatus"]||"default",u=n["customerName"],o=r["customerName"];if(t.setEdgeColor(s,t.status[i]),"branch"===u){var l="success"===r["customerStatus"]||"running"===r["customerStatus"]?"success":"waiting";t.setEdgeColor(s,t.status[l])}if("Aggregation"===o){var c=t.R.filter(t.R.propEq("target",r),t.R.propOr([],"edges",r)),g=t.R.map(t.R.path(["source","customerStatus"]),c);t.R.includes("waiting",g)||t.R.includes("failed",g)?r["customerStatus"]="waiting":r["customerStatus"]="success"}}))},makeItemDraggable:function(){var t=this;this.$nextTick(function(){var e=t.$refs.dragItem;!(e instanceof Array)||e.length<=0||t.R.isNil(t.graph)||e.forEach(function(e,a){var s=t.toolbarItems[a],n=function(e,a,n,r,i){t.instanceGraph(s,r,i)},r=function(){var t=document.createElement("div");return t.style.border="2px dotted black",t.style.width="50px",t.style.height="50px",t};u["mxUtils"].makeDraggable(e,t.graph,n,r(),0,0,!1,!0)})})},changeStatusHandler:function(t){var e=this,a=t["customerStatus"];this.R.propOr([],"edges",t).forEach(function(s){if(s["source"]===t){e.setEdgeColor(s,e.status[a]);var n=s["target"],r=n["customerName"];if(e.R.equals("node",r)&&("failed"===a&&(n["customerStatus"]="failed"),"waiting"!==a&&"running"!==a||(n["customerStatus"]="waiting")),e.R.equals("Aggregation",r)){var i=e.R.filter(e.R.propEq("target",n),e.R.propOr([],"edges",n)),u=e.R.map(e.R.path(["source","customerStatus"]),i);e.R.includes("waiting",u)||e.R.includes("failed",u)?n["customerStatus"]="waiting":n["customerStatus"]="success"}e.R.equals("parallel",r)&&(n["customerStatus"]="running"===a?"waiting":a)}else{var o=s["source"],l=o["customerName"];e.R.equals("branch",l)&&e.setEdgeColor(s,e.status["success"===a||"running"===a?"success":"waiting"])}})},instanceGraph:function(t,e,a){var s=this.graph.getDefaultParent();this.graph.getModel().beginUpdate();try{var n=this.statusMap,r=this.graph.insertVertex(s,null,null,e,a,50,50,""),u=this.changeStatusHandler;r.customerOptionalStatus=t["OptionalStatus"],r.customerName=t["name"],r.customerTitle=t["title"],n[r["id"]]=t["defaultStatus"],r.customer=!0,i()(r,"customerStatus",{set:function(t){n[r["id"]]=t,u(r)},get:function(){return n[r["id"]]}})}finally{this.graph.getModel().endUpdate()}}},mounted:function(){this.createGraph(),this.initGraph(),this.makeItemDraggable()}},p=m,S=(a("60d8"),Object(d["a"])(p,s,n,!1,null,null,null));e["default"]=S.exports},5147:function(t,e,a){var s=a("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(a){try{return e[s]=!1,!"/./"[t](e)}catch(n){}}return!0}},"60d8":function(t,e,a){"use strict";var s=a("2e89"),n=a.n(s);n.a},6762:function(t,e,a){"use strict";var s=a("5ca1"),n=a("c366")(!0);s(s.P,"Array",{includes:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")("includes")},"6f8a":function(t,e,a){t.exports=a("a440")},a440:function(t,e,a){a("43ba"),t.exports=a("584a").Reflect.defineProperty},aae3:function(t,e,a){var s=a("d3f4"),n=a("2d95"),r=a("2b4c")("match");t.exports=function(t){var e;return s(t)&&(void 0!==(e=t[r])?!!e:"RegExp"==n(t))}},ac6a:function(t,e,a){for(var s=a("cadf"),n=a("0d58"),r=a("2aba"),i=a("7726"),u=a("32e9"),o=a("84f2"),l=a("2b4c"),c=l("iterator"),g=l("toStringTag"),d=o.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},h=n(f),m=0;m<h.length;m++){var p,S=h[m],v=f[S],b=i[S],R=b&&b.prototype;if(R&&(R[c]||u(R,c,d),R[g]||u(R,g,S),o[S]=d,v))for(p in s)R[p]||r(R,p,s[p],!0)}},d2c8:function(t,e,a){var s=a("aae3"),n=a("be13");t.exports=function(t,e,a){if(s(e))throw TypeError("String#"+a+" doesn't accept regex!");return String(n(t))}}}]);
//# sourceMappingURL=chunk-85aa3f16.6d106359.js.map